<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse and Keyboard Control</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* 입력을 받을 영역 */
        #input-area {
            width: 100vw;
            height: 100vh;
            background-color: #f0f0f0;
            border: 2px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #log {
            font-size: 14px;
            margin-top: 10px;
            color: #555;
        }
    </style>
</head>
<body>
    <!-- 마우스 및 키보드 입력을 감지할 공간 -->
    <div id="input-area">
        <p>여기서 마우스를 움직이거나 키보드를 눌러보세요!</p>
    </div>
    <div id="log"></div>

    <script>
        const socket = io();
        const inputArea = document.getElementById('input-area');
        const log = document.getElementById('log');

        let lastX = 0;
        let lastY = 0;

        // 마우스 움직임 감지
        inputArea.addEventListener('mousemove', (event) => {
            const rect = inputArea.getBoundingClientRect();
            const currentX = event.clientX - rect.left; // 상대 좌표로 변환
            const currentY = event.clientY - rect.top;

            const deltaX = currentX - lastX;
            const deltaY = currentY - lastY;

            // 서버로 마우스 이동 정보 전송
            socket.emit('moveMouse', { deltaX, deltaY });

            // 로그 표시
            log.textContent = `Mouse moved: deltaX=${deltaX}, deltaY=${deltaY}`;

            lastX = currentX;
            lastY = currentY;
        });

        // 키보드 입력 감지
        inputArea.addEventListener('keydown', (event) => {
            const key = event.key; // 어떤 키가 눌렸는지 감지

            // 한영키 감지
            if (key === "Hangul" || key === "Hangul/English") {
                // 한영키가 눌렸을 때
                socket.emit('keyPress', { key: 'Hangul' });  // 서버로 한영키 정보 전송
                log.textContent = `Key pressed: 한영키`;
            } else {
                socket.emit('keyPress', { key });  // 일반 키보드 입력 처리
                log.textContent = `Key pressed: ${key}`;
            }
        });

        // 마우스 클릭 감지
        inputArea.addEventListener('mousedown', (event) => {
            const button = event.button; // 0: 왼쪽 버튼, 1: 휠 버튼, 2: 오른쪽 버튼
            socket.emit('mouseClick', { button, type: 'down' });
            log.textContent = `Mouse button ${button} down`;
        });

        inputArea.addEventListener('mouseup', (event) => {
            const button = event.button;
            socket.emit('mouseClick', { button, type: 'up' });
            log.textContent = `Mouse button ${button} up`;
        });

        // 포커스를 보장하기 위해 input-area를 클릭하면 포커스
        inputArea.setAttribute('tabindex', '0');
        inputArea.addEventListener('click', () => inputArea.focus());
    </script>
</body>
</html>
